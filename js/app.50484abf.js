(function(n){function e(e){for(var i,r,c=e[0],s=e[1],l=e[2],d=0,h=[];d<c.length;d++)r=c[d],o[r]&&h.push(o[r][0]),o[r]=0;for(i in s)Object.prototype.hasOwnProperty.call(s,i)&&(n[i]=s[i]);u&&u(e);while(h.length)h.shift()();return a.push.apply(a,l||[]),t()}function t(){for(var n,e=0;e<a.length;e++){for(var t=a[e],i=!0,c=1;c<t.length;c++){var s=t[c];0!==o[s]&&(i=!1)}i&&(a.splice(e--,1),n=r(r.s=t[0]))}return n}var i={},o={app:0},a=[];function r(e){if(i[e])return i[e].exports;var t=i[e]={i:e,l:!1,exports:{}};return n[e].call(t.exports,t,t.exports,r),t.l=!0,t.exports}r.m=n,r.c=i,r.d=function(n,e,t){r.o(n,e)||Object.defineProperty(n,e,{enumerable:!0,get:t})},r.r=function(n){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},r.t=function(n,e){if(1&e&&(n=r(n)),8&e)return n;if(4&e&&"object"===typeof n&&n&&n.__esModule)return n;var t=Object.create(null);if(r.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:n}),2&e&&"string"!=typeof n)for(var i in n)r.d(t,i,function(e){return n[e]}.bind(null,i));return t},r.n=function(n){var e=n&&n.__esModule?function(){return n["default"]}:function(){return n};return r.d(e,"a",e),e},r.o=function(n,e){return Object.prototype.hasOwnProperty.call(n,e)},r.p="/";var c=window["webpackJsonp"]=window["webpackJsonp"]||[],s=c.push.bind(c);c.push=e,c=c.slice();for(var l=0;l<c.length;l++)e(c[l]);var u=s;a.push([0,"chunk-vendors"]),t()})({0:function(n,e,t){n.exports=t("56d7")},"034f":function(n,e,t){"use strict";var i=t("64a9"),o=t.n(i);o.a},"56d7":function(n,e,t){"use strict";t.r(e);t("cadf"),t("551c"),t("f751"),t("097d");var i=t("2b0e"),o=function(){var n=this,e=n.$createElement,i=n._self._c||e;return i("div",{attrs:{id:"app"}},[i("div",{staticClass:"sfp-title"},[i("h3",{staticClass:"status"},[n._v("DSDB      "+n._s(n.status))])]),i("div",{staticClass:"control"},[i("img",{attrs:{id:"logo",alt:"Vue logo",src:t("cf05")}}),i("input",{directives:[{name:"model",rawName:"v-model",value:n.deviceCode,expression:"deviceCode"}],staticClass:"device-id",attrs:{type:"text",name:"Device Code",placeholder:"Input device code here"},domProps:{value:n.deviceCode},on:{input:function(e){e.target.composing||(n.deviceCode=e.target.value)}}}),i("button",{staticClass:"connect",attrs:{disabled:"Connecting"===this.status},on:{click:n.onconnect}},[n._v("\n        "+n._s(n.connectBtnText)+" \n      ")]),i("button",{staticClass:"run",attrs:{disabled:n.runBtnDisabled},on:{click:n.onrun}},[n._v("\n        "+n._s(n.runButtonText)+"\n      ")])]),i("div",{attrs:{id:"main-panel"}},[i("div",{attrs:{id:"bitfile-select"}},[i("input",{attrs:{type:"file",name:"bitfile",id:"bitfile"}}),i("button",{attrs:{id:"upload-btn",disabled:"Idle"!==this.status}},[n._v("Upload")])]),i("div",{attrs:{id:"register-list"}},[i("div",{attrs:{id:"input-pins"}},[i("h3",[n._v("Input Pins")]),i("p",[n._v("x")]),i("input",{directives:[{name:"model",rawName:"v-model.number",value:n.x,expression:"x",modifiers:{number:!0}}],attrs:{type:"number",name:"x",id:""},domProps:{value:n.x},on:{input:function(e){e.target.composing||(n.x=n._n(e.target.value))},blur:function(e){return n.$forceUpdate()}}}),i("p",[n._v("y")]),i("input",{directives:[{name:"model",rawName:"v-model.number",value:n.y,expression:"y",modifiers:{number:!0}}],attrs:{type:"number",name:"y",id:""},domProps:{value:n.y},on:{input:function(e){e.target.composing||(n.y=n._n(e.target.value))},blur:function(e){return n.$forceUpdate()}}})]),i("div",{attrs:{id:"output-pins"}},[i("h3",[n._v("Output Pins")]),i("p",[n._v("sum")]),i("input",{directives:[{name:"model",rawName:"v-model.number",value:n.sum,expression:"sum",modifiers:{number:!0}}],attrs:{type:"number",name:"sum",id:""},domProps:{value:n.sum},on:{input:function(e){e.target.composing||(n.sum=n._n(e.target.value))},blur:function(e){return n.$forceUpdate()}}})])])])])},a=[],r=(t("0d6d"),t("308d")),c=t("6bb5"),s=t("4e2b"),l=(t("ac6a"),t("d225")),u=t("b0b4"),d=Object.freeze({OperationCancelled:"Operation cancelled",Timeout:"Timeout",DeviceConnectionError:"Could not connect to device",ChannelConnectionError:"Could not connect to server",DeviceNotFound:"Could not locate the device",CodePrefix:"Invalid device ID prefix",DuplicatedUsername:"Duplicated name"}),h=Object.freeze({ChannelExists:"Signaling channel already exists",FailToCreate:"Failed to create signaling channel",Timeout:"Connection timed out",Canceled:"Operation cancelled,"}),f=function(){function n(){var e=this;Object(l["a"])(this,n),this._eventListeners={},this._dispatchEvent=function(n){n.type in e._eventListeners&&e._eventListeners[n.type].forEach(function(e){return e.call(n.source,n)})},this._channel=null}return Object(u["a"])(n,[{key:"addEventListener",value:function(n,e){n in this._eventListeners||(this._eventListeners[n]=[]),this._eventListeners[n].push(e)}},{key:"removeEventListener",value:function(n,e){n in this._eventListeners&&(this._eventListeners[n]=this._eventListeners[n].filter(function(n){return n!==e}))}},{key:"_setupEventProxies",value:function(){this._channel.addEventListener("close",this._dispatchEvent),this._channel.addEventListener("error",this._dispatchEvent),this._channel.addEventListener("message",this._dispatchEvent)}},{key:"send",value:function(n){throw new Error('function "send(message)" needs to be implemented by derived class')}},{key:"finalize",value:function(){}}]),n}();f.WebSocket=function(n){function e(n){var t;return Object(l["a"])(this,e),t=Object(r["a"])(this,Object(c["a"])(e).call(this)),t.host=n,t}return Object(s["a"])(e,n),Object(u["a"])(e,[{key:"connect",value:function(n,e){var t=this,i=e&&e.timeout||1e3;return this._connectionPromise=this._connectionPromise||new Promise(function(e,o){var a,r=function(){t._channel.addEventListener("open",s),t._channel.addEventListener("close",u),t._channel.addEventListener("error",d)},c=function(){t._channel&&(t._channel.removeEventListener("open",s),t._channel.removeEventListener("close",u),t._channel.removeEventListener("error",d))},s=function(){clearTimeout(a),c(),t._setupEventProxies(),n.cancel=null,e()},l=function(n){t._connectionPromise=null,clearTimeout(a),c(),t._channel&&t._channel.close(),o(n),t._dispatchEvent({type:"error",reason:n})},u=function(){c(),o(h.FailToCreate)},d=function(){};if(i&&(a=setTimeout(function(){return l(h.Timeout)},i)),t._channel&&1===t._channel.readyState)l(h.ChannelExists);else try{t._channel=new WebSocket(t.host),r()}catch(f){o(h.FailToCreate)}n.cancel=l}),this._connectionPromise}},{key:"disconnect",value:function(){this._channel&&(this._channel.close(),this._channel=null),this._connectionPromise=null}},{key:"send",value:function(n){1===this._channel.readyState&&this._channel.send(n)}}]),e}(f),f.MessageChannel=function(n){function e(n,t,i,o){var a;return Object(l["a"])(this,e),a=Object(r["a"])(this,Object(c["a"])(e).call(this)),a.url=n,a.windowFeatures=i,a.deviceUrl=o,a.windowName=t||"Connection Status",a}return Object(s["a"])(e,n),Object(u["a"])(e,[{key:"connect",value:function(n,e){var t=this,i=e&&e.timeout||2e4;return this._connectionPromise=this._connectionPromise||new Promise(function(e,o){var a="".concat(t.url,"?origin=").concat(document.location.origin);t.deviceUrl&&(a+="&deviceServer=".concat(t.deviceUrl)),t._proxyWindow=window.open(a,t.windowName,t.windowFeatures);var r=setTimeout(function(){c(h.Timeout)},i),c=function(n){t._connectionPromise=null,window.removeEventListener("message",t._handleMessage),clearTimeout(r),t._channel&&(t._channel.close(),t._channel=null),t._proxyWindow&&(t._proxyWindow.close(),t._proxyWindow=null),o(n),t._dispatchEvent({type:"error",reason:n})};t._handleMessage=function(i){switch(i.data){case"createChannel":i.origin===new URL(t.url).origin&&i.source===t._proxyWindow&&(clearTimeout(r),r=null,t._channel=i.ports[0],t._setupEventProxies(),t._channel.start(),n.cancel=null,e());break;case"closing":i.origin!==new URL(t.url).origin||i.source!==t._proxyWindow&&void 0!==i.source||c(h.Canceled);break}},window.addEventListener("message",t._handleMessage),n.cancel=c}),this._connectionPromise}},{key:"disconnect",value:function(){}},{key:"send",value:function(n){this._channel.postMessage(n)}},{key:"finalize",value:function(){var n=this;window.removeEventListener("message",this._handleMessage),this._proxyWindow.postMessage("connected",new URL(this.url).origin),this._channel.close(),setTimeout(function(){n._proxyWindow.close(),n._proxyWindow=null},3e3),this._connectionPromise=null}}]),e}(f);t("7514"),t("34ef");var v=function(){function n(e,t){var i=this;Object(l["a"])(this,n),this._signalingChannel=e,this._id=t,this._internalHandlers={responseHandler:function(n){if(i.onresponse){var e="string"===typeof n.data?n.data:(new TextDecoder).decode(n.data),t=JSON.parse(e);i.onresponse(t)}},dataHandler:function(n){i.ondata&&i.ondata(n.data)},closeHandler:function(n){i.onclose&&i.onclose(n.data)},restartHandler:function(n){i.onrestart&&i.onrestart(n.data)}},this.onresponse=null,this.ondata=null,this.onrestart=null,this._cancelToken={canceled:!1,reason:null,cancel:function(n){this.canceled=!0,this.reason=n,this.oncancel&&this.oncancel(n)}}}return Object(u["a"])(n,[{key:"connect",value:function(n){var e=this;if(!this._connectionPromise){this._cancelToken.canceled=!1,this._cancelToken.reason=null,this._setupRTCChannels();var t=n&&n.timeout||8e3,i=n&&n.retryCount||0,o=n&&n.retryDelay||1e3;this._controlChannel.onmessage=this._internalHandlers.responseHandler,this._dataChannel.onmessage=this._internalHandlers.dataHandler,this._deviceConnection.addEventListener("close",this._internalHandlers.closeHandler);var a=function(n){return new Promise(function(e){return setTimeout(e,n)})},r=function n(e){return function(){var t=e.apply(void 0,arguments);if(t instanceof Promise)return t.catch(function(t){return i-- >1?a(o).then(n(e)):Promise.reject(t)})}},c={},s=function(n,t){return function(){for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return t.canceled?Promise.reject(e._cancelToken.reason):new Promise(function(e,i){t.oncancel=function(n){c.cancel&&c.cancel(),i(n)},n.apply(void 0,o).then(function(n){return t.canceled||e(n)}).catch(function(n){return i(n)})})}},l=function(n){return e._signalingChannel.connect(n,{timeout:6e3}).catch(function(n){return n===h.FailToCreate||n===h.ChannelExists||n===h.Timeout?(window.console.log("connectSignalChannel failed with reason ".concat(n)),Promise.reject(d.ChannelConnectionError)):Promise.reject(n)})},u=-1,f=s(function(){return l(c)},this._cancelToken)().then(s(function(){return u=setTimeout(function(){return e.cancel(d.Timeout)},t),e._deviceConnection.createOffer()},this._cancelToken)).then(s(function(n){return e._deviceConnection.setLocalDescription(n)},this._cancelToken)).then(r(s(function(){return e._negotiateConnection(c)},this._cancelToken))).then(s(function(n){return e._signalingChannel.finalize(),e._removeSignalingHooks(),Promise.resolve(n)},this._cancelToken));this._connectionPromise=f.then(s(function(n){return clearTimeout(u),Promise.resolve(n)},this._cancelToken)).catch(function(n){var t;return clearTimeout(u),e._removeSignalingHooks(),e._signalingChannel.disconnect(),e._deviceConnection.close(),e._deviceConnection=null,e._connectionPromise=null,t=n===h.Timeout?Promise.reject(d.DeviceConnectionError):n===h.Canceled?Promise.reject(d.OperationCancelled):Promise.reject(n),window.console.log("device.connect() failed with reason ".concat(n)),t})}return this._connectionPromise}},{key:"disconnectSignalingChannel",value:function(){this._signalingChannel&&this._signalingChannel.disconnect()}},{key:"disconnect",value:function(){this._deviceConnection&&(this._deviceConnection.close(),this._notifyCloseEvent(),this._deviceConnection=null),this.disconnectSignalingChannel(),this._connectionPromise=null}},{key:"_notifyCloseEvent",value:function(){!this._restartTimeoutId&&this._deviceConnection&&(this._internalHandlers.closeHandler(new CloseEvent("close")),this._deviceConnection=null)}},{key:"cancel",value:function(n){this._cancelToken.cancel(n||d.OperationCancelled)}},{key:"sendCommand",value:function(n){this.connected&&this._controlChannel.send((new TextEncoder).encode(JSON.stringify(n)))}},{key:"sendData",value:function(n,e){if(this.connected){var t=(new TextEncoder).encode(JSON.stringify(e||{})),i=new TextEncoder("utf-8").encode("\r\n"),o=new Uint8Array(t.length+i.length+n.length);o.set(t),o.set(i,t.length),o.set(n,t.length+i.length);var a=16384,r=o.length,c=28,s=a-c,l={HeaderSize:c,DataSize:0,FrameSize:a,TotalDataSize:r,TotalFrames:Math.ceil(r/s),FrameIndex:0,DataOffset:0};while(l.DataOffset<r){if(!this._dataChannel||"open"!==this._dataChannel.readyState)break;var u=new Uint8Array(a);this._writeU32NumberToU8Array(l.HeaderSize,u,0),this._writeU32NumberToU8Array(l.TotalDataSize,u,4),l.DataSize=Math.min(s,r-l.DataOffset),this._writeU32NumberToU8Array(l.DataSize,u,8),this._writeU32NumberToU8Array(l.FrameSize,u,12),this._writeU32NumberToU8Array(l.TotalFrames,u,16),this._writeU32NumberToU8Array(l.FrameIndex,u,20),this._writeU32NumberToU8Array(l.DataOffset,u,24),u.set(o.slice(l.DataOffset,l.DataOffset+l.DataSize),c),this._dataChannel.send(u),l.FrameIndex+=1,l.DataOffset=l.FrameIndex*s}}}},{key:"_writeU32NumberToU8Array",value:function(n,e,t){var i=new ArrayBuffer(4),o=new DataView(i);return o.setUint32(0,n,!0),e.set(new Uint8Array(i),t),e}},{key:"_setupRTCChannels",value:function(){var n=this,e={iceServers:[{urls:["stun:stun.multisim.com:3478","stun:stun.l.google.com:19302","stun:stun1.l.google.com:19302","stun:stun2.l.google.com:19302","stun:stun3.l.google.com:19302","stun:stun4.l.google.com:19302"]}]},t="undefined"!==typeof InstallTrigger;t&&e.iceServers.forEach(function(n){n.urls=n.urls.slice(0,2)}),this._deviceConnection=new RTCPeerConnection(e),this._deviceConnection.onicecandidate=function(e){window.console.log("onicecandidate event.candidate = ".concat(e.candidate)),e.candidate&&("open"===n._negotiationChannel.readyState?n._negotiationChannel.send((new TextEncoder).encode(JSON.stringify(e.candidate))):n._signalingChannel.send(JSON.stringify({address:n.id,command:"candidate",candidate:e.candidate})))},this._deviceConnection.oniceconnectionstatechange=function(e){switch(window.console.log("oniceconnectionstatechange to ".concat(e.target.iceConnectionState)),e.target.iceConnectionState){case"failed":n._restartTimeoutId?(clearTimeout(n._restartTimeoutId),n._restartTimeoutId=null,n._internalHandlers.closeHandler(new CloseEvent("close")),n.disconnect()):(n._restartTimeoutId=setTimeout(function(){n._restartTimeoutId=null},6e4),n.disconnect(),n.connect().then(function(){n._internalHandlers.restartHandler(new CustomEvent("restart"))}).catch(function(){n._internalHandlers.closeHandler(new CloseEvent("close")),n.disconnect()}));break;case"closed":n._notifyCloseEvent();break;default:break}},this._dataChannel=this._deviceConnection.createDataChannel("data"),this._dataChannel.binaryType="arraybuffer",this._controlChannel=this._deviceConnection.createDataChannel("control"),this._controlChannel.binaryType="arraybuffer",this._negotiationChannel=this._deviceConnection.createDataChannel("rtc-negotiation"),this._negotiationChannel.binaryType="arraybuffer"}},{key:"_negotiateConnection",value:function(n){var e=this;return new Promise(function(t,i){e._installSignalingHooks(t,i,n),e._signalingChannel.send(JSON.stringify({address:e.id,command:"offer",offer:e._deviceConnection.localDescription}))})}},{key:"_installSignalingHooks",value:function(n,e,t){var i=this,o=function(n){i._removeSignalingHooks(),e(new Error(n))};t.cancel=o;var a=function(){"open"===i._dataChannel.readyState&&"open"===i._controlChannel.readyState&&"open"===i._negotiationChannel.readyState&&(i._dataChannel.onopen=null,i._controlChannel.onopen=null,i._negotiationChannel.onopen=null,i._dataChannel.onerror=null,i._controlChannel.onerror=null,i._negotiationChannel.onerror=null,n())},r=function(n){o(n)};this._handleSignalingMessage=function(n){var e=JSON.parse(n.data);if(e.address===i.id||"usb"===i.id)switch(e.command){case"answer":i._deviceConnection.setRemoteDescription(e.answer);break;case"candidate":i._deviceConnection.addIceCandidate(e.candidate);break}},this._handleSignalingError=function(n){n.reason===h.Canceled?i.cancel(n.reason):(window.console.log("_handleSignalingError failed with reason ".concat(n.reason)),e(d.ChannelConnectionError))},this._handleSignalingClose=function(n){4e3===n.code?i.cancel(d.DeviceNotFound):(window.console.log("_handleSignalingClose failed with event ".concat(n,", code ").concat(n.code)),i.cancel(d.ChannelConnectionError))},this._signalingChannel.addEventListener("message",this._handleSignalingMessage),this._signalingChannel.addEventListener("error",this._handleSignalingError),this._signalingChannel.addEventListener("close",this._handleSignalingClose),this._dataChannel.onopen=a,this._controlChannel.onopen=a,this._negotiationChannel.onopen=a,this._dataChannel.onerror=r,this._controlChannel.onerror=r,this._negotiationChannel.onerror=r}},{key:"_removeSignalingHooks",value:function(){this._signalingChannel.removeEventListener("message",this._handleSignalingMessage),this._signalingChannel.removeEventListener("error",this._handleSignalingError),this._signalingChannel.removeEventListener("close",this._handleSignalingClose),this._dataChannel.onopen=null,this._controlChannel.onopen=null,this._negotiationChannel.onopen=null,this._dataChannel.onerror=null,this._controlChannel.onerror=null,this._negotiationChannel.onerror=null}},{key:"id",get:function(){return this._id}},{key:"connected",get:function(){var n=this,e=["connected","completed","disconnected"];return!(!this._deviceConnection||!e.find(function(e){return e===n._deviceConnection.iceConnectionState}))}}]),n}(),_=Object.freeze({Unconnect:"Not connected",Idle:"Idle",Connecting:"Connecting",Running:"Running"}),m={name:"app",components:{},data:function(){return{username:"fpgacloud",deviceCode:"",instrument:"",status:_.Unconnect,signalServer:"wss://sigserver.multisim.com:1339",runButtonText:"Run",connectBtnText:"Connect",runBtnDisabled:!0,x:1,y:1,sum:2}},methods:{onconnect:function(){this.status===_.Unconnect?this.connect():(this.status===_.Running&&this.stop(),this.disconnect())},onrun:function(){this.status===_.Running?(this.stop(),this.status=_.Idle):(this.configureAndRun(),this.status=_.Running)},connect:function(){var n=this;this.status=_.Connecting;var e=function(){window.console.log("Connnect succeffuly!");var e={device:{device:[{command:"open",username:n.username},{command:"enumerate"},{command:"getDeviceInformation"}]}};n.instrument.onclose=function(){n.status=_.Unconnect},n.instrument.ondata=function(n){window.console.log("data: "),window.console.log(n)},n.instrument.onresponse=function(n){window.console.log("response: "),window.console.log(n)},n.instrument.onrestart=function(){n.instrument.sendCommand(e)},n.instrument.sendCommand(e),n.status=_.Idle,n.runBtnDisabled=!1};this.instrument=new v(new f.WebSocket(this.signalServer),this.deviceCode),this.instrument.connect().then(e,function(){n.status=_.Unconnect,window.console.log("Failed to connect via manual connect target")})},disconnect:function(){this.instrument.disconnect()},configureAndRun:function(){},stop:function(){}},watch:{status:function(n){switch(n){case _.Idle:this.connectBtnText="Disconnect",this.runButtonText="Run";break;case _.Running:this.runButtonText="Stop";break;case _.Unconnect:this.connectBtnText="Connect";break}}}},g=m,p=(t("034f"),t("2877")),C=Object(p["a"])(g,o,a,!1,null,null,null),w=C.exports;i["a"].config.productionTip=!1,new i["a"]({render:function(n){return n(w)}}).$mount("#app")},"64a9":function(n,e,t){},cf05:function(n,e,t){n.exports=t.p+"img/logo.82b9c7a5.png"}});
//# sourceMappingURL=app.50484abf.js.map